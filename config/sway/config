#!/usr/bin/env bash

# ══════════════════════════════════════════════════════════════════════════════
#  SWAY CONFIGURATION
#  Elegant · Functional · Minimal
# ══════════════════════════════════════════════════════════════════════════════

# Start clipboard
exec wl-paste --watch cliphist store
xwayland enable


# ──────────────────────────────────────────────────────────────────────────────
#  Additional Configurations
# ──────────────────────────────────────────────────────────────────────────────

include /etc/sway/config.d/*
include ~/.cache/wal/colors-sway


# ──────────────────────────────────────────────────────────────────────────────
#  Startup Programs
# ──────────────────────────────────────────────────────────────────────────────

exec mako --config ~/.cache/wal/mako


# ──────────────────────────────────────────────────────────────────────────────
#  Modifier Keys
# ──────────────────────────────────────────────────────────────────────────────

# Logo key as modifier (Mod1 = Alt, Mod4 = Super/Logo)
set $mod Mod4


# ──────────────────────────────────────────────────────────────────────────────
#  Navigation Keys
# ──────────────────────────────────────────────────────────────────────────────

# Vim-style navigation
set $left h
set $down j
set $up k
set $right l


# ──────────────────────────────────────────────────────────────────────────────
#  Pywal Color Scheme
# ──────────────────────────────────────────────────────────────────────────────

# Colors are automatically generated by pywal
# Window Border Colors using pywal variables:
# class                 border      background  text        indicator   child_border
client.focused          $color5     $color3     $foreground $color13    $color13
client.focused_inactive $color6     $color8     $foreground $color14    $color6
client.unfocused        $color8     $color0     $color7     $color8     $color8
client.urgent           $color1     $color1     $foreground $color9     $color9


# ──────────────────────────────────────────────────────────────────────────────
#  Window Rules
# ──────────────────────────────────────────────────────────────────────────────

# Chat Applications
for_window [app_id="libera"] {
    floating enable
    resize set height 500 px
    resize set width 900 px
    move position 1000 5
    border pixel 3
}

for_window [app_id="tilde"] {
    floating enable
    resize set height 500 px
    resize set width 900 px
    move position 950 325
    border pixel 3
}

for_window [class="Signal Beta"] {
    floating enable
    resize set height 980 px
    resize set width 800 px
    move position 30 25
    border pixel 3
}

# Media Applications
for_window [app_id="cava"] {
    floating enable
    resize set height 525 px
    resize set width 750 px
    move position 1135 490
    border pixel 3
}

for_window [class="Spotify"] {
    floating enable
    resize set height 650 px
    resize set width 1050 px
    move position 15 15
    border pixel 3
}

for_window [app_id="mpv"] {
    inhibit_idle fullscreen
    border pixel 3
}

for_window [app_id="vlc"] {
    floating enable
    resize set 1000 700
    move position center
    border pixel 2
}

# Image Viewer
for_window [app_id="imv"] {
    floating enable
    resize set 1000 700
    move position center
    border pixel 2
}

# Security Applications
for_window [app_id="veracrypt"] {
    floating enable
    border pixel 3
}

# Python Applications
for_window [app_id="python3"] {
    floating enable
    border pixel 3
}

# System Utilities
for_window [app_id="pavucontrol"] {
    floating enable
    resize set 800 600
    move position center
    border pixel 2
}

for_window [app_id="btop"] {
    floating enable
    resize set 1000 700
    move position center
    border pixel 2
}

for_window [app_id="copilot-kitty"] {
    floating enable
    resize set width 500 px height 1009 px
    move position 1402 px 2 px
}

for_window [app_id="chromium" title="Open File"] {
    floating enable
    resize set 1000 700
    move position center
    border pixel 2
}

# Network Manager
assign [title="nmtui"] workspace number 99
for_window [title="nmtui"] {
    floating enable
    resize set 800 600
    move position center
    move to workspace current
}

# Games
for_window [title="brick_break"] floating enable


# ──────────────────────────────────────────────────────────────────────────────
#  Display Configuration
# ──────────────────────────────────────────────────────────────────────────────

# Wallpaper (using pywal variable)
output * bg $wallpaper fill

# Monitor Setup
output eDP-1 {
    resolution 1920x1080
    position 1920,0
    allow_tearing no
}

# Performance optimization
output * max_render_time off


# ──────────────────────────────────────────────────────────────────────────────
#  Input Configuration
# ──────────────────────────────────────────────────────────────────────────────

# Touchpad Settings
input type:touchpad {
    dwt enabled                # Disable while typing
    pointer_accel 1            # Pointer acceleration
    accel_profile flat         # Flat acceleration profile
    tap enabled                # Tap to click
    drag_lock disable          # Disable drag lock
    natural_scroll enabled     # Natural scrolling
}

# Uncomment for custom keyboard layout
# input type:keyboard {
#     xkb_layout "eu"
# }


# ──────────────────────────────────────────────────────────────────────────────
#  Window Behavior
# ──────────────────────────────────────────────────────────────────────────────

focus_follows_mouse yes

# Borders and gaps
gaps inner 5
gaps outer 3
default_border pixel 2
default_floating_border pixel 2

# Smart gaps and borders
smart_gaps off
smart_borders off


# ──────────────────────────────────────────────────────────────────────────────
#  Idle Configuration
# ──────────────────────────────────────────────────────────────────────────────

exec swayidle -w \
    timeout 120 'swaylock -f \
        --screenshots \
        --clock \
        --indicator \
        --indicator-radius 100 \
        --indicator-thickness 7 \
        --effect-blur 9x5 \
        --effect-vignette 0.5:0.5 \
        --ring-color 444444 \
        --key-hl-color 777777 \
        --line-color 00000000 \
        --inside-color 000000aa \
        --separator-color 00000000 \
        --grace 2 \
        --fade-in 0.2' \
    timeout 180 'swaymsg "output * power off"' \
    resume 'swaymsg "output * power on"' \
    before-sleep 'swaylock -f \
        --screenshots \
        --clock \
        --indicator \
        --indicator-radius 100 \
        --indicator-thickness 7 \
        --effect-blur 9x5 \
        --effect-vignette 0.5:0.5 \
        --ring-color 444444 \
        --key-hl-color 777777 \
        --line-color 00000000 \
        --inside-color 000000aa \
        --separator-color 00000000 \
        --grace 2 \
        --fade-in 0.2'


# ══════════════════════════════════════════════════════════════════════════════
#  KEYBINDINGS
# ══════════════════════════════════════════════════════════════════════════════

# ──────────────────────────────────────────────────────────────────────────────
#  Default Applications
# ──────────────────────────────────────────────────────────────────────────────

set $term kitty
set $browser zen-browser
set $file-manager kitty -e yazi
set $system-monitor kitty --class btop -e btop
set $editor kitty --class neovim -e nvim


# ──────────────────────────────────────────────────────────────────────────────
#  Basic Controls
# ──────────────────────────────────────────────────────────────────────────────

bindsym $mod+Return exec $term
bindsym $mod+b exec $browser
bindsym $mod+e exec $editor
bindsym $mod+n exec $file-manager
bindsym $mod+q kill
bindsym $mod+Shift+m exec $system-monitor

# Application launcher
bindsym $mod+space exec wofi --show drun \
    --prompt "Applications" \
    --xoffset 785 \
    --yoffset 30 \
    --width 350 \
    --height 280 \
    --hide-scroll \
    --matching=fuzzy \
    --insensitive \
    --allow-markup \
    --style ~/.config/wofi/style.css

# Notifications
bindsym Control+space exec makoctl dismiss

# Configuration management
bindsym $mod+r reload
bindsym $mod+Shift+r exec swaymsg exit

# Floating window modifier
floating_modifier $mod normal

# Utilities
bindsym $mod+Shift+e exec $HOME/bin/power-menu.sh
bindsym $mod+c exec $HOME/bin/ai.sh
bindsym $mod+alt+w exec $HOME/bin/waybar-toggle.sh


# ──────────────────────────────────────────────────────────────────────────────
#  Focus Navigation
# ──────────────────────────────────────────────────────────────────────────────

# Focus movement (Vim keys)
bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right

# Focus movement (Arrow keys)
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# Window movement (Vim keys + Shift)
bindsym $mod+Shift+$left move left
bindsym $mod+Shift+$down move down
bindsym $mod+Shift+$up move up
bindsym $mod+Shift+$right move right

# Window movement (Arrow keys + Shift)
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right


# ──────────────────────────────────────────────────────────────────────────────
#  Workspace Management
# ──────────────────────────────────────────────────────────────────────────────

# Switch to workspace
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9
bindsym $mod+0 workspace number 10

# Move container to workspace
bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4
bindsym $mod+Shift+5 move container to workspace number 5
bindsym $mod+Shift+6 move container to workspace number 6
bindsym $mod+Shift+7 move container to workspace number 7
bindsym $mod+Shift+8 move container to workspace number 8
bindsym $mod+Shift+9 move container to workspace number 9
bindsym $mod+Shift+0 move container to workspace number 10


# ──────────────────────────────────────────────────────────────────────────────
#  Layout Management
# ──────────────────────────────────────────────────────────────────────────────

# Container layouts
bindsym $mod+t layout toggle tabbed

# Fullscreen toggle
bindsym $mod+f fullscreen

# Floating controls
bindsym $mod+s floating toggle
bindsym $mod+Shift+s focus mode_toggle


# ──────────────────────────────────────────────────────────────────────────────
#  Scratchpad Management
# ──────────────────────────────────────────────────────────────────────────────

bindsym $mod+Shift+minus move scratchpad
bindsym $mod+minus scratchpad show


# ──────────────────────────────────────────────────────────────────────────────
#  Window Resizing
# ──────────────────────────────────────────────────────────────────────────────

bindsym $mod+alt+$left resize shrink width 20px
bindsym $mod+alt+$up resize grow height 20px
bindsym $mod+alt+$down resize shrink height 20px
bindsym $mod+alt+$right resize grow width 20px


# ──────────────────────────────────────────────────────────────────────────────
#  Media & Hardware Keys
# ──────────────────────────────────────────────────────────────────────────────

# Audio controls
bindsym --locked XF86AudioRaiseVolume exec $HOME/bin/volume-up.sh
bindsym --locked XF86AudioLowerVolume exec $HOME/bin/volume-down.sh
bindsym --locked XF86AudioMute exec pactl set-sink-mute $(pactl list | rg 'Sink #' | sed 's/Sink #//') toggle

# Brightness controls
bindsym --locked XF86MonBrightnessUp exec brightnessctl set 5%+
bindsym --locked XF86MonBrightnessDown exec brightnessctl set 5%-

# Media playback controls
bindsym --locked XF86AudioPlay exec playerctl -p spotify play-pause
bindsym --locked XF86AudioNext exec playerctl -p spotify next
bindsym --locked XF86AudioPrev exec playerctl -p spotify previous

# Do Not Disturb toggle
bindsym --locked $mod+d exec sh -c \
    "notify-send -i $HOME/Pictures/icons/dnd.png ' Do Not Disturb' 'Turning on Do Not Disturb Mode' && sleep 2 && makoctl set-mode do-not-disturb"
bindsym --locked $mod+Shift+d exec sh -c \
    "makoctl set-mode default && notify-send -i $HOME/Pictures/ictures/icons/dnd.png ' Do Not Disturb' 'Do Not Disturb Mode disabled'"


# ──────────────────────────────────────────────────────────────────────────────
#  Screenshot & Utilities
# ──────────────────────────────────────────────────────────────────────────────

# Screenshots
bindsym Print exec $HOME/bin/screenshot.sh
bindsym $mod+Print exec $HOME/bin/partial-screenshot.sh

# Clipboard
bindsym $mod+v exec cliphist list | wofi -S dmenu --prompt "Clipboard" | cliphist decode | wl-copy
bindsym $mod+Shift+v exec cliphist wipe

# Emoji picker
bindsym $mod+period exec $HOME/bin/emoji-picker.sh

# Wallpaper switch
bindsym $mod+w exec $HOME/bin/wallpaper.sh
bindsym $mod+Shift+w exec $HOME/bin/wallpaper.sh -r

# Color picker
bindsym $mod+p exec $HOME/bin/colorpicker.sh

# Caffeine mode
bindsym $mod+Shift+c exec ~/bin/caffeine-toggle.sh toggle


# ──────────────────────────────────────────────────────────────────────────────
#  Status Bar
# ──────────────────────────────────────────────────────────────────────────────

bar {
    swaybar_command waybar
}


# ══════════════════════════════════════════════════════════════════════════════
#  End of Configuration
# ══════════════════════════════════════════════════════════════════════════════
